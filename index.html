<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AutoTyper-X Dashboard</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background: linear-gradient(135deg, #0d1b2a, #1b263b);
      color: #e0e1dd;
      min-height: 100vh;
    }
    .navbar-brand {
      font-weight: bold;
      font-size: 1.5rem;
    }
    .card {
      background: rgba(27, 38, 59, 0.85);
      border: none;
    }
    .card-header {
      background: #1b263b;
      font-weight: 600;
    }
    .form-control,
    .form-select {
      background: #0d1b2a;
      border: 1px solid #415a77;
      color: #e0e1dd;
    }
    .form-control:focus,
    .form-select:focus {
      border-color: #778da9;
      box-shadow: none;
    }
    button {
      min-width: 120px;
    }
    .output {
      font-family: monospace;
      white-space: pre-wrap;
      background: #0d1b2a;
      padding: 0.75rem;
      border-radius: 0.25rem;
      border: 1px solid #415a77;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
    <a class="navbar-brand" href="#">AutoTyper-X</a>
    <div class="ms-auto">
      <span class="navbar-text">Control Panel</span>
    </div>
  </nav>

  <div class="container py-4">
    <div class="row gy-4">
      <!-- Start Racer Card -->
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-header">Start Racer</div>
          <div class="card-body">
            <div class="mb-2">
              <label class="form-label">API Token</label>
              <input id="token" type="password" class="form-control" placeholder="Enter API token" />
            </div>
            <div class="row">
              <div class="col-sm-6 mb-2">
                <label class="form-label">Owner</label>
                <input id="owner" type="text" class="form-control" placeholder="default" value="default"/>
              </div>
              <div class="col-sm-6 mb-2">
                <label class="form-label">Username</label>
                <input id="username" type="text" class="form-control" placeholder="NitroType user" />
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6 mb-2">
                <label class="form-label">Password</label>
                <input id="password" type="password" class="form-control" placeholder="••••••" />
              </div>
              <div class="col-sm-6 mb-2">
                <label class="form-label">WPM</label>
                <input id="wpm" type="number" class="form-control" min="30" max="170" value="60" />
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6 mb-2">
                <label class="form-label">Races</label>
                <input id="races" type="number" class="form-control" min="1" max="5000" value="10" />
              </div>
              <div class="col-sm-6 mb-2">
                <label class="form-label">Accuracy %</label>
                <input id="accuracy" type="number" class="form-control" min="0" max="100" value="90" />
              </div>
            </div>
            <button id="btn-start" class="btn btn-primary mt-2">Start</button>
            <div id="start-output" class="output mt-3"></div>
          </div>
        </div>
      </div>

      <!-- Manage Tasks Card -->
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-header">Manage Tasks</div>
          <div class="card-body">
            <div class="mb-2">
              <label class="form-label">Owner</label>
              <input id="m-owner" type="text" class="form-control" placeholder="default" value="default"/>
            </div>
            <div class="mb-2">
              <label class="form-label">Username (for stop)</label>
              <input id="m-username" type="text" class="form-control" placeholder="NitroType user" />
            </div>
            <div class="d-flex gap-2 flex-wrap">
              <button id="btn-stop" class="btn btn-warning">Stop Racer</button>
              <button id="btn-stopall" class="btn btn-danger">Stop All</button>
              <button id="btn-tasks" class="btn btn-secondary">List Tasks</button>
            </div>
            <div id="tasks-output" class="output mt-3"></div>
          </div>
        </div>
      </div>

      <!-- Statistics Card -->
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-header">Statistics & Tracker</div>
          <div class="card-body">
            <div class="row gy-2">
              <div class="col-sm-4">
                <button id="btn-tracker" class="btn btn-info w-100">Get Tracker</button>
              </div>
              <div class="col-sm-4">
                <button id="btn-stats" class="btn btn-info w-100">Get Stats</button>
              </div>
              <div class="col-sm-4">
                <button id="btn-admintasks" class="btn btn-info w-100">Admin Tasks</button>
              </div>
            </div>
            <div id="stats-output" class="output mt-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS & dependencies -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/js/bootstrap.bundle.min.js"
  ></script>
  <script>
    const API_BASE = "";

    function getToken() {
      return document.getElementById("token").value.trim();
    }

    async function callApi(path, method = "GET", body = null, params = {}) {
      const token = getToken();
      const url = new URL(API_BASE + path, window.location.origin);
      url.searchParams.set("token", token);
      Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));

      const opts = { method };
      if (body) {
        opts.headers = { "Content-Type": "application/json" };
        opts.body = JSON.stringify(body);
      }
      const res = await fetch(url, opts);
      const text = await res.text();
      try { return JSON.parse(text); }
      catch { return text; }
    }

    // Start racer
    document.getElementById("btn-start").onclick = async () => {
      const data = {
        owner: document.getElementById("owner").value,
        username: document.getElementById("username").value,
        password: document.getElementById("password").value,
        wpm: document.getElementById("wpm").value,
        race_amount: document.getElementById("races").value,
        min_accuracy: document.getElementById("accuracy").value
      };
      const out = await callApi("/racer", "POST", data);
      document.getElementById("start-output").innerText = JSON.stringify(out, null, 2);
    };

    // Stop single racer
    document.getElementById("btn-stop").onclick = async () => {
      const data = {
        owner: document.getElementById("m-owner").value,
        username: document.getElementById("m-username").value
      };
      const out = await callApi("/stopracer", "POST", data);
      document.getElementById("tasks-output").innerText = JSON.stringify(out, null, 2);
    };

    // Stop all racers
    document.getElementById("btn-stopall").onclick = async () => {
      const data = { owner: document.getElementById("m-owner").value };
      const out = await callApi("/stopall", "POST", data);
      document.getElementById("tasks-output").innerText = JSON.stringify(out, null, 2);
    };

    // List tasks
    document.getElementById("btn-tasks").onclick = async () => {
      const owner = document.getElementById("m-owner").value;
      const out = await callApi("/tasks", "GET", null, { owner });
      document.getElementById("tasks-output").innerText = JSON.stringify(out, null, 2);
    };

    // Get tracker for one user
    document.getElementById("btn-tracker").onclick = async () => {
      const owner = document.getElementById("m-owner").value;
      const username = document.getElementById("m-username").value;
      const out = await callApi("/tracker", "GET", null, { owner, username });
      document.getElementById("stats-output").innerText = JSON.stringify(out, null, 2);
    };

    // Get overall stats
    document.getElementById("btn-stats").onclick = async () => {
      const out = await callApi("/stats", "GET");
      document.getElementById("stats-output").innerText = JSON.stringify(out, null, 2);
    };

    // Admin tasks
    document.getElementById("btn-admintasks").onclick = async () => {
      const target_owner = document.getElementById("m-owner").value;
      const out = await callApi("/admintasks", "GET", null, { target_owner });
      document.getElementById("stats-output").innerText = JSON.stringify(out, null, 2);
    };
  </script>
</body>
</html>
